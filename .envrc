# Direnv configuration for Vivian Backend
# Install direnv: brew install direnv
# Then run: direnv allow

# Python version to use
export PYTHON_VERSION="3.11"

# Check if we're in a virtual environment
if [ -z "$VIRTUAL_ENV" ]; then
    # Try to find and activate the MCP server venv (most likely to have pytest)
    if [ -d "apps/test-mcp-server/venv" ]; then
        echo "üêç Activating MCP server virtual environment..."
        source apps/test-mcp-server/venv/bin/activate
    elif [ -d "venv" ]; then
        echo "üêç Activating root virtual environment..."
        source venv/bin/activate
    else
        echo "‚ö†Ô∏è  No virtual environment found."
        echo "   To create one for testing:"
        echo "   cd apps/test-mcp-server && python3 -m venv venv && pip install -e \".[test]\""
    fi
fi

# Add helpful aliases
alias test-mcp="cd apps/test-mcp-server && source venv/bin/activate && pytest tests/ -v"
alias test-all="pytest"
alias seed-id="docker compose exec -T api python scripts/seed_identity.py"
alias db-shell="docker compose exec api python scripts/db_shell.py"

echo "üöÄ Vivian Backend ready!"
echo "   Run tests: pytest"
echo "   Run MCP tests only: test-mcp"
echo "   Seed identity data: seed-id --home-name \"My Home\" --seed-all-roles"
echo "   Open preloaded DB shell: db-shell"
